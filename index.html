<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Scrapie by groupby</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/groupby/scrapie">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/groupby/scrapie/blob/master/scrapie-latest.zip?raw=true">ZIP</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        

        <h1>
<a name="-scrapie" class="anchor" href="#-scrapie"><span class="octicon octicon-link"></span></a>
<img src="https://github.com/groupby/scrapie/raw/master/src/main/images/sheepVerySmall.png" alt="Scrapie"> Scrapie</h1>

<p>A Web Scraper.<br><em>Not the fatal, degenerative disease that affects the nervous systems of sheep and goats.</em></p>

<p><a href="https://codeship.io/projects/27011">
<img height="20" src="https://codeship.io/projects/1df14350-ef55-0131-b5ae-023491d184db/status" alt="Codeship Status for groupby/scrapie"></a> <a href="https://waffle.io/groupby/scrapie">
<img height="20" src="https://badge.waffle.io/groupby/scrapie.png?label=ready&amp;title=Ready" alt="Stories in Ready"></a></p>
<br></br>
<h2>
<a name="quickstart" class="anchor" href="#quickstart"><span class="octicon octicon-link"></span></a>Quickstart</h2>

<ol>
<li>Make sure Java 1.7 is on your computer and the java command is on your path.</li>
<li>Download the <a href="https://github.com/groupby/scrapie/blob/master/scrapie-latest.zip?raw=true">scrapie-latest.zip</a> </li>
<li>Unpack it <code>scrapie-x.x.x</code> and go into the directory <code>cd scrapie-x.x.x</code>
</li>
<li>run the test 

<ul>
<li>on *nix <code>./scrapie -f google.js -o google.xml</code><br>
</li>
<li>on windows <code>scrapie.bat -f google.js -o google.xml</code> </li>
</ul>
</li>
</ol>
<br></br>
<h2>
<a name="docs" class="anchor" href="#docs"><span class="octicon octicon-link"></span></a>Docs</h2>

<p>Read the <a href="https://github.com/groupby/scrapie/blob/master/API.md">API.md</a> and the <a href="https://github.com/groupby/scrapie/blob/master/Emitter.md">Emitter.md</a> to learn about scrapie.</p>

<br></br>
<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Requires that Java 1.7 is installed and on your path.</p>

<pre style="font-family:'courier new'">usage: scrapie
 -f,--file &lt;arg&gt;        The JavaScript file to use
 -o,--output &lt;arg&gt;      The file to output to
 -r,--record &lt;arg&gt;      Record this run and stop after N records
                        have been emitted
 -t,--type &lt;arg&gt;        The record type, json or xml (default)
 -v,--verbosity &lt;arg&gt;   Log Level, trace, debug, info (default)
</pre>

Unix
<pre style="font-family:'courier new'">./scrapie -f myScraper.js -o records.xml
</pre>
Or windows
<pre style="font-family:'courier new'">scrapie.bat -f myScraper.js -o records.xml
</pre>

<br></br>
<h2>
<a name="examples-scraper-files" class="anchor" href="#examples-scraper-files"><span class="octicon octicon-link"></span></a>Examples Scraper Files</h2>

<h3>
<a name="low-complexity" class="anchor" href="#low-complexity"><span class="octicon octicon-link"></span></a>Low Complexity</h3>

<p>Where each URL contains one record.</p>

<div class="highlight highlight-JavaScript"><pre><span class="kd">var</span> <span class="nx">urlIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UrlIterator</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pIndex</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pIndex</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"http://www.example.com/index.html?id="</span> <span class="o">+</span> <span class="nx">pIndex</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">});</span>
<span class="nx">urlIterator</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
   <span class="nx">pContext</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="nx">pContext</span><span class="p">.</span><span class="nx">getJqText</span><span class="p">(</span><span class="s2">"title"</span><span class="p">));</span>
   <span class="nx">pContext</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="medium-complexity" class="anchor" href="#medium-complexity"><span class="octicon octicon-link"></span></a>Medium Complexity</h3>

<p>Where each URL is a list page with ten items and each item should be emitted as a separate record.</p>

<div class="highlight highlight-JavaScript"><pre><span class="kd">var</span> <span class="nx">urlIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UrlIterator</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pIndex</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pIndex</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"http://www.example.com/list?page="</span> <span class="o">+</span> <span class="nx">pIndex</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">});</span>
<span class="nx">urlIterator</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">pContext</span><span class="p">.</span><span class="nx">breakIntoSections</span><span class="p">(</span><span class="s2">".item"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
        <span class="nx">process</span><span class="p">(</span><span class="nx">pContext</span><span class="p">);</span>
        <span class="nx">pContext</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">pContext</span><span class="p">.</span><span class="nx">getJq</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">"="</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="nx">pContext</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
    <span class="nx">pContext</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="nx">pContext</span><span class="p">.</span><span class="nx">getJqText</span><span class="p">(</span><span class="s2">"a"</span><span class="p">));</span>
<span class="p">}</span>

</pre></div>

<h3>
<a name="high-complexity" class="anchor" href="#high-complexity"><span class="octicon octicon-link"></span></a>High Complexity</h3>

<p>Where each URL is a list page, each list page has 10 items and each item has a detail page URL with additional info.</p>

<div class="highlight highlight-JavaScript"><pre><span class="kd">var</span> <span class="nx">urlIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UrlIterator</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pIndex</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pIndex</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"http://www.example.com/list?page="</span> <span class="o">+</span> <span class="nx">pIndex</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">});</span>
<span class="nx">urlIterator</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">print</span><span class="p">(</span><span class="nx">pContext</span><span class="p">.</span><span class="nx">getHtml</span><span class="p">());</span>
    <span class="nx">pContext</span><span class="p">.</span><span class="nx">breakIntoSections</span><span class="p">(</span><span class="s2">".item"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">workingId</span> <span class="o">=</span> <span class="nx">pContext</span><span class="p">.</span><span class="nx">getJq</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"href"</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">"="</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
        <span class="nx">pContext</span><span class="p">.</span><span class="nx">setWorkingId</span><span class="p">(</span><span class="nx">workingId</span><span class="p">);</span>
        <span class="nx">processListItem</span><span class="p">(</span><span class="nx">pContext</span><span class="p">);</span>
        <span class="nx">pContext</span><span class="p">.</span><span class="nx">emitForWorkingId</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="nx">workingId</span><span class="p">);</span>
        <span class="nx">pContext</span><span class="p">.</span><span class="nx">processUrlsJq</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
            <span class="nx">processDetailPage</span><span class="p">(</span><span class="nx">pContext</span><span class="p">);</span>
            <span class="nx">pContext</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">});</span>    
<span class="p">});</span>
<span class="kd">function</span> <span class="nx">processListItem</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
    <span class="nx">pContext</span><span class="p">.</span><span class="nx">emitForWorkingId</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="nx">pContext</span><span class="p">.</span><span class="nx">getJqText</span><span class="p">(</span><span class="s2">"a"</span><span class="p">));</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">processDetailPage</span><span class="p">(</span><span class="nx">pContext</span><span class="p">){</span>
    <span class="nx">pContext</span><span class="p">.</span><span class="nx">emitForWorkingId</span><span class="p">(</span><span class="s2">"price"</span><span class="p">,</span> <span class="nx">pContext</span><span class="p">.</span><span class="nx">getJqText</span><span class="p">(</span><span class="s2">"#price"</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<br></br>
<h2>
<a name="goals" class="anchor" href="#goals"><span class="octicon octicon-link"></span></a>Goals</h2>

<p>A scraper that will generate URLs to crawl and convert them into objects we want to keep.</p>

<ul>
<li>must not use XML configuration as using XML to parse HTML is an escaping nightmare.</li>
<li>must understand the concept of multiple of the same objects being created from one big page.</li>
<li>must be able to log in to password protected sites.</li>
<li>must be able to understand the concpet of a listing page that goes to a detail page to generate the object or objects.</li>
<li>must be able to resuse global items across pages.  Maybe back multiple pages.</li>
<li>the syntax must be as small as possible.</li>
<li>be threaded (which it isn't yet)</li>
</ul>

<br></br>
<h2>
<a name="choices" class="anchor" href="#choices"><span class="octicon octicon-link"></span></a>Choices</h2>

<p>Under the hood the JavaScript scraper files connect to a Java object that uses Jsoup.<br>
Jsoup was extended to include XPath support.<br>
A regular expression matcher is also available.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52980434-1', 'auto');
  ga('send', 'pageview');

</script>
</html>